/*! BUILD: 2015-05-19 */
Common.controllers.Menu=Spine.Controller.sub({el:"#nav",MinShengLoaded:!1,MobileWithdrawLoaded:!1,EnterpriseServiceLoaded:!1,tipsFlag:!1,init:function(){this.loadMenuList(),this.el.show()},events:{"click a[key]":"showSubmenu"},loadMenuList:function(){function a(a){var b,c,d,e,f,g,h,i,j=a.top.concat(a.bottom),k={};for(b=0,d=j.length;d>b;b++)if(f=j[b],f.submenu&&f.submenu.length>0){if(!f.key)continue;for(k[f.key]=f.submenu,g=f.submenu,h=new Common.Hashtable,e=g.length,c=0;e>c;c++)i=g[c],i.submenu&&i.submenu.length>0?h.add(i.key,i.submenu):h.add(i.key,[])}else k[f.key]=f.controller;return k}function b(a){function b(a,b){var c,d,e,f,g;if(a)for(c=0,d=a.length;c<a.length;c++)e=a[c],f=$("<li></li>"),f.addClass("nav-item"),c===d-1&&f.addClass("last"),g=$("<a></a>"),g.attr("href","javascript:void(0);"),g.attr("lan",e.lan),g.attr("key",e.key),f.append(g),b.append(f)}var c=a.home,e=a.top,f=a.bottom;return $("<a>").attr({href:"javascript:void(0)",lan:c.lan,key:c.key}).appendTo("#nav-home"),b(e,$("#nav-top")),b(f,$("#nav-bottom")),CU.changeLan(d.el),d.el}var c,d=this;c=1==Common.currentUser.segmentId||66==Common.currentUser.segmentId?Common.menu.MenuForVip:Common.menu.MenuForSearch,Common.menu.MenuHash=a(c),Common.menu.firstClassMenu=b(c)},showSubmenu:function(a){var b=this,c=$(a.target);if(a.preventDefault(),$("#nav .nav-item").removeClass("current"),c.parent().addClass("current"),$("#content").removeClass("w978"),"PersonLivelihood"!==c.attr("key")||b.MinShengLoaded)if("TransfersAndRemittances"!==c.attr("key")||b.MobileWithdrawLoaded)if("EnterpriseService"!==c.attr("key")||!Common.triggerEnterprise&&b.EnterpriseServiceLoaded){if(Common.privList&&"0"==Common.privList.length&&"EnterpriseService"===c.attr("key"))return void Common.LightBox.showMessage(CU.getDictNameByKey("false"==b.tipsFlag?"l57136":"l59277"));Spine.trigger("showSubmenu",c.attr("key"))}else Common.LightBox.show(),Common.request(new Model("SmePrivilegeListQuery"),function(a){{var d=a,e=[];new Common.Hashtable}Common.triggerActionDelay&&(Common.triggerSubMenuAuto=!1),Common.privList=d.privList,d&&d.privList&&d.privList.length>0?($.each(d.privList,function(a,b){e.push(b.functionId)}),b.showOrHideMenu(e),Spine.trigger("showSubmenu",c.attr("key"))):(b.tipsFlag="false",Common.LightBox.showMessage(CU.getDictNameByKey("l57136")))},function(){Common.privList=[],b.tipsFlag=!0},function(){Common.LightBox.hide(),b.EnterpriseServiceLoaded=!0,Common.triggerEnterprise=!1,Common.triggerActionDelay&&Common.triggerActionDelay()});else Common.LightBox.show(),Common.postRequest(new Model("PsnMobileIsSignedAgent")).then(function(a){var d=CU.ajaxDataHandle(a);Common.triggerActionDelay&&(Common.triggerSubMenuAuto=!1),d.flag+""=="true"&&$.each(Common.menu.MenuHash.TransfersAndRemittances,function(a,b){return"mobileDraw"==b.key?(Common.menu.MenuHash.TransfersAndRemittances[a].submenu.push({lan:"l52183",key:"",controller:"cMobileDraw"}),void Common.menu.MenuHash.TransfersAndRemittances[a].submenu.push({lan:"l52184",key:"",controller:"cMobileDrawQuery"})):void 0}),b.MobileWithdrawLoaded=!0,Spine.trigger("showSubmenu",c.attr("key")),Common.LightBox.hide(),Common.triggerActionDelay&&Common.triggerActionDelay()});else Common.LightBox.show(),MinSheng.initialize(function(){Common.triggerActionDelay&&(Common.triggerSubMenuAuto=!1),Spine.trigger("showSubmenu",c.attr("key")),b.MinShengLoaded=!0,Common.LightBox.hide(),Common.triggerActionDelay&&Common.triggerActionDelay()})},showOrHideMenu:function(a){var b=[],c=[],d=[],e=[],f=["VF0011","VF0012","VF0013","VF0021","VF0031","VF0041","VF0051","VF0061","VF0071","VF0111","VF0081","VF0091","VF0101"],g=0,h=0,i=0,j=0,k=0;Common.menu.MenuHash.EnterpriseService=[{key:"EnAccountManage",lan:"l4378",submenu:[]},{key:"transRemit",lan:"l0029",submenu:[]},{key:"EmployeesManager",lan:"l55815",submenu:[]},{key:"TradeInfoSet",lan:"l55820",submenu:[]}],$.each(f,function(f,i){if($.inArray(i,a)>-1)switch(f){case 0:b.push({lan:"l4389",key:"",controller:"TodayBalanceQuery"});break;case 1:b.push({lan:"l55823",key:"",controller:"HistoryBalanceQuery"});break;case 2:b.push({lan:"l0682",key:"",controller:"TradingQuery"});break;case 3:g++;break;case 4:h++;break;case 5:h++;break;case 6:c.push({lan:"l0188",key:"",controller:"TransRecord"});break;case 7:c.push({lan:"l0187",key:"",controller:"EnterPayeeManage"});break;case 8:d.push({lan:"l55817",key:"",controller:"AuthSet"});break;case 9:d.push({lan:"l55818",key:"",controller:"ServiceLogout"});break;case 10:d.push({lan:"l55819",key:"",controller:"OperaterRecords"});break;case 11:e.push({lan:"l55821",key:"",controller:"FixedRelaSet"});break;case 12:e.push({lan:"l55822",key:"",controller:"TradePurposeSet"})}}),(g>0||h>0)&&(h>0&&c.unshift({lan:"l10538",key:"",controller:"EnterBatransfer"}),c.unshift({lan:"l55847",key:"",controller:"SingleTrans"})),b.length>0?(i=1,$.each(b,function(a,b){Common.menu.MenuHash.EnterpriseService[0].submenu.push(b)})):Common.menu.MenuHash.EnterpriseService.shift(),c.length>0?(j=1,$.each(c,function(a,b){Common.menu.MenuHash.EnterpriseService[i].submenu.push(b)})):Common.menu.MenuHash.EnterpriseService.splice(i,1),d.length>0?(k=1,$.each(d,function(a,b){Common.menu.MenuHash.EnterpriseService[i+j].submenu.push(b)})):Common.menu.MenuHash.EnterpriseService.splice(i+j,1),e.length>0?$.each(e,function(a,b){Common.menu.MenuHash.EnterpriseService[i+j+k].submenu.push(b)}):Common.menu.MenuHash.EnterpriseService.splice(i+j+k,1)}});