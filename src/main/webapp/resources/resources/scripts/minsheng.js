/*! BUILD: 2015-05-19 */
!function(){"use strict";function a(a){try{return a.replace(/\./g,k.DOT)}catch(b){return a}}function b(a){"function"==typeof a&&Common.postRequest(CU.createConversation()).then(function(b){CU.isSuccesful(b),a(CU.ajaxDataHandle(b))})}function c(a,b){"function"==typeof b&&Common.postRequest(CU.createTokenId(a)).then(function(a){CU.isSuccesful(a),b(CU.ajaxDataHandle(a))})}function d(b){var c,d;if(b)for(c in b)d=b[c],c=a(k.PREFIX+c),Regional[c]={},Regional[c][lan]=d}function e(a,b){var c,d,e,f=this;if($.browser.msie){if(c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(a),c.parseError&&0!=c.parseError.errorCode)return e=c.parseError,void Common.LightBox.showMessage(CU.getDictNameByKey("l9019")+e.line+CU.getDictNameByKey("l9020")+e.reason+CU.getDictNameByKey("l9021")+e.srcText)}else d=new DOMParser,c=d.parseFromString(a,"text/xml");DateUtil.getCurrentTime(function(a){k.DATETIME=a,MS_Parser.parse.call(f,c,k,b)})}function f(a,f){Common.controllers[a]=Spine.Controller.sub({ejsPath:{home:"templates/minsheng/home.ejs"},item:f,flowCached:{},name:"MinShengController",events:{"click #next":"startParse"},init:function(){var a=this;MinSheng.redirect?(a.flowFileId=MinSheng.redirect.flowFileId,a.prvcShortName=MinSheng.redirect.prvcShortName,a.startParse()):(a.flowFileId=null,Common.LightBox.show(),a.el.empty().html(a.ejsPath.home,{title:a.item.menusName},function(){CU.changeLan(a.el),a.getItemList()}))},getItemList:function(){$("#flowIntro").hide(),$("#prvcList").hide(),$("#cityList").hide(),$("#flowList").hide();var a=this;a.itemName=null,a.flowFileId=null,Common.postRequest(new Model("PsnPlpsQuerySubItemsByMenuId",{menuId:a.item.menusId})).then(function(b){Common.LightBox.hide();var c,d,e=CU.ajaxDataHandle(b);if(CU.isSuccesful(b)){for(c=0,d=e.length;d>c;c++)e[c]={key:e[c].itemId,val:e[c].itemName};a.itemList=new ITSelect({data:e,disabled:0===d,oddCls:"even",appendTo:$("#selectItem").empty(),defText:CU.getDictNameByKey("l0092"),defVal:"",callback:function(){a.getPrvcList(this.val),a.itemName=this.txt}})}})},getPrvcList:function(a){$("#flowIntro").hide();var b=this;b.flowFileId=null,b.prvcShortName=null,$("#selectCity").empty(),$("#selectArea").empty(),$("#selectFlow").empty(),$("#cityList").hide(),$("#areaList").hide(),$("#flowList").hide(),Common.LightBox.show(),Common.postRequest(new Model("PsnPlpsQueryFlowFileAdscription",{itemId:a,queryType:"1"})).then(function(c){Common.LightBox.hide();var d,e,f=CU.ajaxDataHandle(c),g=f.provinceList,h=f.flowFileList;for(g=g?g:[],d=0,e=g.length;e>d;d++)g[d]={key:g[d].prvcShortName,val:g[d].prvcName};CU.isSuccesful(c)&&($("#prvcList").show(),b.prvcList=new ITSelect({data:g,disabled:0===e,oddCls:"even",appendTo:$("#selectPrvc").empty(),defText:CU.getDictNameByKey("l0092"),defVal:"",callback:function(){b.getCityList(a,this.val),b.prvcShortName=this.val}}),b.showFlowList(h))})},getCityList:function(a,b){$("#flowIntro").hide();var c=this;c.flowFileId=null,$("#selectArea").empty(),$("#selectFlow").empty(),$("#areaList").hide(),$("#flowList").hide(),Common.LightBox.show(),Common.postRequest(new Model("PsnPlpsQueryFlowFileAdscription",{itemId:a,prvcShortName:b,queryType:"2"})).then(function(d){Common.LightBox.hide();var e,f,g=CU.ajaxDataHandle(d),h=g.cityList,i=g.flowFileList;for(h=h?h:[],e=0,f=h.length;f>e;e++)h[e]={key:h[e].displayNo,val:h[e].cityName};CU.isSuccesful(d)&&($("#cityList").show(),c.cityList=new ITSelect({data:h,disabled:0===f,oddCls:"even",appendTo:$("#selectCity").empty(),defText:CU.getDictNameByKey("l0092"),defVal:"",callback:function(){c.getFlowList(a,b,this.val)}}),c.showFlowList(i))})},getFlowList:function(a,b,c){$("#flowIntro").hide();var d=this;d.flowFileId=null,d.flowFileName=null,$("#selectFlow").empty(),$("#flowList").hide(),Common.LightBox.show(),Common.postRequest(new Model("PsnPlpsQueryFlowFileAdscription",{itemId:a,prvcShortName:b,cityDispNo:c,queryType:"3"})).then(function(a){Common.LightBox.hide();var b=CU.ajaxDataHandle(a),c=b.flowFileList;c=c?c:[],CU.isSuccesful(a)&&d.showFlowList(c)})},showFlowList:function(a){var b,c,d=this,e={};if(d.flowFileId=null,d.flowFileName=null,a){for(b=0,c=a.length;c>b;b++)e[a[b].flowFileId]=a[b],a[b]={key:a[b].flowFileId,val:a[b].flowFileName};$("#flowList").show(),d.flowList=new ITSelect({data:a,disabled:0===c,oddCls:"even",appendTo:$("#selectFlow").empty(),defText:CU.getDictNameByKey("l0092"),defVal:"",callback:function(){d.flowFileId=this.val,d.flowFileName=this.txt,e[this.val].infoUrl?$("#flowIntro").attr("href",e[this.val].infoUrl).show():$("#flowIntro").attr("href","#").hide()}})}},startParse:function(){var a=this;(a.flowFileId||formValid.checkAll(a.el))&&(Common.LightBox.show(),b(function(b){a.cid=b,a.getFlowFile(b)}))},getFlowFile:function(a){var b=this,f=b.flowCached[b.prvcShortName+b.flowFileId];f=f?"1":"0",Common.postRequest(new Model("PsnPlpsQueryFlowFileAndLang",{flowFileId:b.flowFileId,prvcShortName:b.prvcShortName,_refresh:f},a)).then(function(f){var g=CU.ajaxDataHandle(f);CU.isSuccesful(f)?(b.flowCached[b.prvcShortName+b.flowFileId]="1",c(a,function(c){Common.LightBox.hide(),b.saveLog(a,c)}),d(g.flowFileLangMap),e.call(b,g.flowFileXmlStream,a)):Common.LightBox.hide()})},reloadLan:function(){var a=this;a.flowFileId&&$("#mstabs").size()>0&&Common.postRequest(new Model("PsnPlpsQueryFlowFileAndLang",{flowFileId:a.flowFileId,prvcShortName:a.prvcShortName,_refresh:"2"},a.cid)).then(function(b){var c=CU.ajaxDataHandle(b);CU.isSuccesful(b)&&(d(c.flowFileLangMap),CU.changeLan(a.el),$("label[pos]").each(function(){try{$(this).html($(this).text().replace(/\\n/g,"<br/>"))}catch(a){}}))})},reloadSelect:function(){var a=this;a.flowFileId&&0!==$("#mstabs").size()||(CU.changeLan(a.el),a.el.find("h4.layout-tb-caption").text(a.item.menusName),a.getItemList())},saveLog:function(a,b){var c=this;Common.postRequest(new Model("PsnPlpsSaveBocServiceLog",{menuName:c.item.menusName,itemName:c.itemName,flowFileName:c.flowFileName,token:b},a))}})}function g(b){Common.LightBox.show(),Common.postRequest(new Model("PsnPlpsQueryChildrenMenus")).then(function(c){if(CU.isSuccesful(c)){var d,e,g,h,i=CU.ajaxDataHandle(c),j=Common.menu.MenuHash[k.KEY];for(Common.menu.MinSheng=[],window.Regional||(window.Regional={}),e=0,g=i.length;g>e;e++)d=i[e],h=a(k.PREFIX+"MENU_"+d.menusId),Regional[h]={},Regional[h][lan]=d.menusName,j.push({lan:h,flow:h}),Common.menu.MinSheng.push({key:d.menusId,val:d.menusName}),f(h,d)}Common.LightBox.hide(),b()})}function h(){Common.postRequest(new Model("PsnPlpsQueryChildrenMenus")).then(function(b){if(CU.isSuccesful(b)){{var c,d,e,f,g=CU.ajaxDataHandle(b);Common.menu.MenuHash[k.KEY]}for(Common.menu.MinSheng=[],d=0,e=g.length;e>d;d++)c=g[d],f=a(k.PREFIX+"MENU_"+c.menusId),Regional[f]={},Regional[f][lan]=c.menusName,Common.menu.MinSheng.push({key:c.menusId,val:c.menusName}),Common.controllers[f].prototype.item=c;if(CU.changeLan($("#subMenu")),$("#subMenu h3").text($("#nav li.nav-item.current a").text()),Common.mainAction)for(var f in Common.mainAction)Common.mainAction[f]&&("MyMinSheng"===Common.mainAction[f].name&&Common.mainAction[f].reloadSelect(),"MinShengController"===Common.mainAction[f].name&&Common.mainAction[f].reloadSelect())}})}function i(){if(Common.mainAction)for(var a in Common.mainAction)Common.mainAction[a]&&"MinShengController"===Common.mainAction[a].name&&Common.mainAction[a].reloadLan()}var j={},k={KEY:"PersonLivelihood",PREFIX:"",DOT:"+",EJS:{TABS:"templates/minsheng/tabs.ejs"}};j.initialize=function(a){g(a),Spine.bind("language_changed",function(){h(),i()})},j.CONFIG=k,window.MinSheng=j}(document);