/*! BUILD: 2014-07-09 */
!function(d){"use strict";function ce(a){return d.createElement(a)}function ct(a){return d.createTextNode(a)}function cf(){return d.createDocumentFragment()}function emptyContainer(){var a=cf(),b=container[cn],c=b.length;for(Parser.clearVariables();c--;)a[ac](b[0]);lastStep.view=a}function escapeKey(a){try{return a.replace(/\./g,CONFIG.DOT)}catch(b){return a}}function getAccountText(a){var b;try{b=CU.getDictNameByKey("payeraccount_"+a.accountType)+" "+StringUtil.maskAccount(a.accountNumber)+" "+a.nickName+" "+CU.getDictNameByKey("payeraccount_"+a.accountIbkNum)}catch(c){b=""}return b}function stringify(a){var b,c=[];for(b in a)c.push(b+":"+a[b]);return"{"+c.join(",")+"}"}function setValidateGroupAndTips(elem,checkrule,tip,useTip){if(checkrule&&"checkbox"!==elem[ga]("type")&&"radio"!==elem[ga]("type")){var obj=eval("("+checkrule.replace(/\\/g,"\\")+")"),group={},tips=[],regName,tipName,text;("true"==obj.required||obj.required===!0)&&(group.required=!0,tips.push("tipsrequired")),obj.maxlength&&(elem[sa]("maxlength",obj.maxlength),group.maxLength=obj.maxlength,tips.push("tipsmax")),obj.minlength&&(group.minLength=obj.minlength,tips.push("tipsmin")),obj.rangelength&&(group.minLength=obj.rangelength[0],group.maxLength=obj.rangelength[1],tips.push("tipsmax"),tips.push("tipsmin")),obj.amountformat&&(elem[sa]("currCode",obj.amountformat),elem[sa]("lan","num"),"001"==obj.amountformat&&(group.reg87=!0,tips.push("tips0293"))),obj.dateformat&&elem[sa]("lan","date"),obj.nonlicetchar&&(group.nonlicetchar=!0),obj.pattern&&(regName=CONFIG.PREFIX+escape(obj.pattern.source).replace(/\%|\-|\+|\.|\*/g,"_"),formValid.valid.regGroup[regName]={regExp:obj.pattern},group[regName]=!0),obj.datecompare&&(elem[sa]("datecompare",obj.datecompare.join(",")),obj.required&&"true"==obj.required||(group.required=!0,tips.push("tipsrequired"))),obj.equalto&&elem[sa]("equalto",obj.equalto),"date"===elem[ga]("lan")&&(group.reg48=!0,tips.push("tips0261"),group.required||(group.required=!0,tips.push("tipsrequired"))),tip&&"true"==useTip?(text=CU.getDictNameByKey(escapeKey(CONFIG.PREFIX+tip)),text?(tips.push(escapeKey(CONFIG.PREFIX+tip)),elem[sa]("prompt",text)):(tipName=CONFIG.PREFIX+escape(tip).replace(/\%|\-|\+|\.|\*/g,"_"),Regional[tipName]={},Regional[tipName][lan]=tip,tips.push(tipName),elem[sa]("prompt",tip))):tips.length<2&&-1===elem[cs].indexOf("sel")&&tips.push(CONFIG.PREFIX+"extraTip"),"{}"!==stringify(group)&&(elem[sa]("validateGroup",stringify(group)),elem[cs]=elem[cs]+" validateGroup"),tips.length>0&&elem[sa]("tips",tips.join(" "))}}function setTips(){}function restoreValidate(a){var b=$(a),c=b.attr("_validateGroup"),d=b.attr("_tips");c&&b.attr("validateGroup",c).removeAttr("_validateGroup").addClass("validateGroup").removeClass("_validateGroup"),d&&b.attr("tips",d).removeAttr("_tips")}function removeValidate(a){var b=$(a),c=b.attr("validateGroup"),d=b.attr("tips");b.removeAttr("pass").removeClass("warning"),c&&b.attr("_validateGroup",c).removeAttr("validateGroup").addClass("._validateGroup").removeClass("validateGroup"),d&&b.attr("_tips",d).removeAttr("tips")}function formatDate(a,b){var c;try{c=8===a.length?dateReg.exec(a):timeReg.exec(a),b=b.replace("yyyy",c[1]),b=b.replace("MM",c[2]),b=b.replace("dd",c[3]),b=b.replace("HH",c[4]),b=b.replace("mm",c[5]),b=b.replace("ss",c[6])}catch(d){return""}return b}function getPeriodDate(a,b,c){switch("string"==typeof a&&(a=new Date(a.replace(/\-/g,"/"))),c=parseInt(c),b){case"Y":a.setYear(a.getYear()+c);break;case"M":a.setMonth(a.getMonth()+c);break;case"D":a.setDate(a.getDate()+c)}return a.toString("/")}function getDatePickerPattern(a){return a=a.toLowerCase(),a=a.replace("yyyy","%Y"),a=a.replace("mm","%m"),a=a.replace("dd","%d")}function getStampParams(a){if(0===a.indexOf("{"))return null;var b,c,d,e=a.split(","),f={};for(b=0,c=e.length;c>b;b++)d=e[b].substr(0,e[b].indexOf("{")),f[d]=Parser.getVariable(d);return f}function getSsmParams(a){var b,c,d,e,f,g=a.indexOf("[");if(-1===g)return null;for(a=a.substring(g,a.length-1),b=a.split(","),f={},c=0,d=b.length;d>c;c++)e=b[c].split(":")[1],f[e]=Parser.getVariable(e);return f}function getVarStr(a){return varReg.test(a)?varReg.exec(a)[1]:a}var Parser={},digits=["零","一","二","三","四","五","六","七","八","九","十","十一","十二"],ac="appendChild",sa="setAttribute",ga="getAttribute",gt="getElementsByTagName",cn="childNodes",nv="nodeValue",cs="className",varReg=/\$\{(.+)\}/,expReg=/[a-zA-z\$_]+[^\s\><\=\!\'\"]*/g,flowReg=/branch_flow\=([^,]+)/,stepReg=/branch_step\=([^,]+)/,dateReg=/(\d{4})(\d{2})(\d{2})/,timeReg=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/,queryBalance="templates/common/queryAccountBalance.ejs",creditBalance="templates/common/credQueryAccountBalance.ejs",ctrl,xml,sys,container,CONFIG,cid,lastFlow,lastStep,prevFlow,prevStep,otp,smc,signedData;Parser.parse=function(a,b,c){ctrl=this,xml=a,CONFIG=b,cid=c,Regional[CONFIG.PREFIX+"extraTip"]={},Regional[CONFIG.PREFIX+"extraTip"][lan]="请按要求正确输入",formValid.valid.regGroup.nonlicetchar={regExp:/^[^\[\]\^\$\\~@#%&<>{}:'"]*$/},Parser.reset(),Parser.parseMenu(function(){Parser.parseFlow(),Parser.init()})},Parser.init=function(){container=ce("div"),container[sa]("id","mscontainer"+Common.getIdentityId()),ctrl.el.append(container),CU.changeLan($("#mstabs")),Parser.changeStep(),Parser.bindEvents()},Parser.testCond=function(cond){var rst=cond.match(expReg),i,len,v,q;if("true"==cond)return!0;if(!rst)return!1;for(i=0,len=rst.length;len>i;i++)v=Parser.getVariable(rst[i]),"string"==typeof v&&(v="'"+v+"'"),q=cond.charAt(cond.indexOf(rst[i])-1),"'"!==q&&'"'!==q&&(cond=cond.replace(rst[i],v));try{return eval(cond)}catch(e){return!1}},Parser.register=function(){var a=$(container).find("dfn[type=registerdb]");a.size()>0&&(a=a.filter(function(a){return!$(a).closest("dfn.loop_type")&&!$(a).closest("dfn.if_type")}).eq(0),a&&Common.postRequest(CU.createTokenId(cid)).then(function(b){var c,d,e,f=CU.ajaxDataHandle(b),g=a.attr("argskey").split(","),h=[];if(CU.isSuccesful(b)){for(c=0,d=g.length;d>c;c++)e=sys.db[g[c]],isArray(e)&&(e=e.join("|")),h.push(e);Common.postRequest(new Model("PsnPlpsRegisterDbRecord",{flowFileId:ctrl.flowFileId,isDisp:"true"==a.attr("isdisp")?"1":"0",argsKey:g.join("&"),argsVal:h.join("&"),summary:a.attr("summary"),flowName:a.attr("flowname"),stepName:a.attr("stepname"),token:f},cid))}}))},Parser.requestComms=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o=a.action,p=d;if(o&&o.comms||o&&o.security){if(o&&o.comms){o.security&&!o.security.cond&&(h=o.security),o.security&&o.security.cond&&!b&&(e={__security__:o.security}),b&&b.__security__&&Parser.testCond(b.__security__.cond)&&(h=b.__security__),j=[],k=[],f=b?b:o.comms,n=0;for(i in f)if(n+=1,"__security__"!==i){if(l=f[i],!b&&l.step&&(l.tempStep=l.step),l.cond||l.tempStep){if(!b){e||(e={}),l.tempStep&&(l.tempStep-=1),e[i]=l;continue}if(l.tempStep){l.tempStep-=1,e||(e={}),e[i]=l;continue}if(l.cond&&!Parser.testCond(l.cond))continue}if(m={isSendCsp:"1",isSecurityTools:h&&!p?"1":"0",toCspParamsMap:Parser.getRequestParams(l.request),prvcShortName:ctrl.prvcShortName,transCode:l.transaction,bankId:l.bankId,flowFileId:ctrl.flowFileId},h&&!p)switch(m.security=h.action,p=!0,h.action){case"init":g=function(){$("#stool-selector").hasClass("chose-stool")||($("#stool-selector").addClass("chose-stool"),Common.SF.showSelector("PB151",function(){CU.changeLan($("div.chose-stool"))},null,cid))};break;case"active":m._combinId=Common.SF.get("combinId"),m.stamp=h.stamp,$.extend(m,getStampParams(h.stamp)),m.ssm=h.ssm,$.extend(m,getSsmParams(h.ssm));break;case"verify":if(otp&&$.extend(m,{Otp:otp.Value,Otp_RC:otp.RandomKey_C,state:otp.State,activ:otp.Version}),smc&&$.extend(m,{Smc:smc.Value,Smc_RC:smc.RandomKey_C,state:smc.State,activ:smc.Version}),signedData){if(!signedData.result)return Parser.backStep(),!1;$.extend(m,{_signedData:signedData.result})}m.stamp=h.stamp,$.extend(m,getStampParams(h.stamp))}j.push(new Model("PsnPlpsSendAllFlowFileReq",m,cid)),sys.response[i]={},k.push({obj:i,val:l.response})}h&&1===n&&f.__security__&&Parser.requestComms({action:{security:f.__security__}})}else if(o&&o.security){switch(h=o.security,m={isSendCsp:"0",isSecurityTools:"1",security:h.action,toCspParamsMap:null,pageParamsMap:null,prvcShortName:ctrl.prvcShortName,flowFileId:ctrl.flowFileId},h.action){case"init":g=function(){$("#stool-selector").hasClass("chose-stool")||($("#stool-selector").addClass("chose-stool"),Common.SF.showSelector("PB151",function(){CU.changeLan($("div.chose-stool"))},null,cid))};break;case"active":m._combinId=Common.SF.get("combinId"),m.stamp=h.stamp,$.extend(m,getStampParams(h.stamp)),m.ssm=h.ssm,$.extend(m,getSsmParams(h.ssm));break;case"verify":if(otp&&$.extend(m,{Otp:otp.Value,Otp_RC:otp.RandomKey_C,state:otp.State,activ:otp.Version}),smc&&$.extend(m,{Smc:smc.Value,Smc_RC:smc.RandomKey_C,state:smc.State,activ:smc.Version}),signedData){if(!signedData.result)return Parser.backStep(),!1;$.extend(m,{_signedData:signedData.result})}m.stamp=h.stamp,$.extend(m,getStampParams(h.stamp))}j=[new Model("PsnPlpsSendAllFlowFileReq",m,cid)],k=[{obj:"security"}]}if($(container).hide(),!j||0===j.length){if(e)Parser.requestComms(a,e);else try{Parser.insertVariables(),Parser.renderStep(),$(container).show(),Parser.register()}catch(q){}return}Common.postRequest(j).then(function(b){for(var d=0,f=k.length;f>d;d++){var i,j=k[d],l=CU.ajaxDataHandle(b,d);if(!CU.isSuccesful(b,d))return void(c||Parser.backStep());if(i=l.cspReturnMap||l.securityToolsInfo,j.val)for(var m in j.val)sys.response[j.obj][m]=i[j.val[m]];sys.response[j.obj]||(sys.response[j.obj]={}),$.extend(sys.response[j.obj],i),!l.securityToolsInfo||sys.response.security&&"{}"!==JSON.stringify(sys.response.security)||(sys.response.security=$.extend({},l.securityToolsInfo))}if("function"==typeof g&&g(),h&&"active"===h.action&&Common.SF.appendInputTo($("#stool-list"),function(){$("#SignerContainer").size()>0&&1===$("#stool-list").children("li.sf-list-item").size()||CU.changeLan($("#stool-list").show())},sys.response.security),e)Parser.requestComms(a,e,void 0,p);else try{Parser.insertVariables(),Parser.renderStep(),$(container).show(),Parser.register()}catch(n){}})}else Parser.renderStep(),$(container).show()},Parser.backStep=function(){(prevFlow||prevStep)&&(prevFlow&&($("#content li.tabs").removeClass("tabs-current"),$("#content li.tabs[flow="+prevFlow.name+"]").addClass("tabs-current")),Parser.changeStep(prevStep.name,prevFlow.name,!1,!0))},Parser.changeStep=function(a,b,c,d){var e,f;if(lastFlow&&(prevFlow=lastFlow),lastStep&&(prevStep=lastStep),0===arguments.length){if(MinSheng.redirect)return MinSheng.redirect.dispMap&&$.extend(sys.context,MinSheng.redirect.dispMap),Parser.changeStep(MinSheng.redirect.step,MinSheng.redirect.flow),$("#mstabs").find("li").removeClass("tabs-current"),$("#mstabs [flow="+MinSheng.redirect.flow+"]").addClass("tabs-current"),MinSheng.redirect=null,void delete MinSheng.redirect;e=lastFlow||sys.first,f=lastStep||e.first}else e=b?sys.flows[b]:lastFlow,f=a?e.steps[a]:e.first;if(otp=Common.SF.get("Otp"),smc=Common.SF.get("Smc"),$(container).find("#SignerContainer").size()>0&&c){if(signedData=Common.SF.get("signedData"),signedData&&!signedData.result)return void(signedData=null);if(4&Common.SF.get("combinId")&&!signedData)return}lastFlow&&lastStep&&(emptyContainer(),$("div.SecEditCtrl").empty()),container[ac](f.view),Parser.insertVariables(),Parser.requestComms(f,null,d),lastFlow=e,lastStep=f},Parser.renderStep=function(){var a,b;$("dfn.if_type").each(function(){try{var a=$(this),b=a.children(),c=a.attr("test"),d=a.attr("testId");d||(d=Common.getIdentityId(),a.attr("testId",d)),a.parent().children(".from_if[testId="+d+"]").remove(),Parser.testCond(c)&&b.clone().attr({from:"if",testId:d}).addClass("from_if").insertAfter(a)}catch(e){}}),$("dfn.loop_type").each(function(){try{var a=$(this),b=Parser.getVariable(a.attr("use")),c=a.attr("for");if(!isArray(b))return;if(a.closest("dfn.if_type"))return;a.parent().find(">span[type=checkbox],>span[type=radio]").remove(),a.find(">span[type=checkbox],>span[type=radio]").each(function(){var d,e,f,g,h=$(this),i=0;for(d=0,e=b.length;e>d;d++)g=b[d],f=h.clone(),f.find("var[use]").each(function(){var a=$(this).attr("use");0===a.indexOf(c+".")&&(a=a.substr(c.length+1),this.setAttribute("value",g[a]))}),f.find("label[use]").each(function(){var a=getVarStr($(this).attr("use"));0===a.indexOf(c+".")&&(a=a.substr(c.length+1),$(this).text(g[a]))}),i>0&&f.find("input[type=checkbox],input[type=radio]").each(function(){$(this).removeAttr("required").removeAttr("paramkey")}),a.parent().append(f),i+=1}),a.parent().children("tr[from=loop]").remove(),a.children("tr").each(function(){var d,e,f,g,h=$(this),i=0,j={};for(e=b.length-1;e>=0;e--)f=b[e],d=h.clone().attr("from","loop").addClass("from_loop"),1&e?d.addClass("even").removeClass("odd"):d.addClass("odd").removeClass("even"),d.find("input[type=radio],input[type=checkbox]").each(function(){$(this).attr("value",e)}),d.find("input[type=checkbox]").each(function(){sys.context._checkbox_&&$(this).val()in sys.context._checkbox_&&$(this).attr("checked",!0)}),d.find("span[type=checkbox],span[type=radio]").each(function(){var a=$(this);a.find("var[use]").each(function(){var a=$(this).attr("use");-1===a.indexOf(c+".")&&this.setAttribute("bind",a)})}),d.find("var[use]").each(function(){var a=$(this).attr("use");0===a.indexOf(c+".")&&(a=a.substr(c.length+1),"use"==$(this).attr("type")?$(this).text(f[a]):this.setAttribute("value",f[a]))}),d.find("input[type=text]").each(function(){var a,b,c,e=$(this).attr("name"),f=Parser.getVariable(e);if(j[e]||(j[e]=0),f)f=f.split("|"),a=f.length,b=a-1-j[e],b>-1&&$(this).attr("bindtarget")&&(c=d.find(".boundflag_"+$(this).attr("bindtarget")),c.size()>0&&(c.is(":checked")||Parser.getVariable(c.attr("name"))==c.val())&&($(this).val(f[b]),j[e]+=1));else try{$(this).attr("bindtarget")&&(c=d.find(".boundflag_"+$(this).attr("bindtarget")),c.size()>0&&c.attr("checked")&&$(this).val(sys.context._checkbox_[c.val()][$(this).attr("name")]))}catch(g){}}),d.find("var[lan=num]").each(function(){var a=getVarStr($(this).attr("_value"));0===a.indexOf(c+".")&&(a=a.substr(c.length+1),$(this).text(f[a]),this[sa]("value",f[a])),$(this).parent().css("text-align","right")}),d.find("var[type=formatdate]").each(function(){var a=$(this).attr("value");0===a.indexOf(c+".")&&(a=a.substr(c.length+1),$(this).text(formatDate(f[a],$(this).attr("pattern"))))}),d.find("label[use]").each(function(){var a=get($(this).attr("use"));0===a.indexOf(c+".")&&(a=a.substr(c.length+1),$(this).text(f[a]))}),d.find("dfn[type=translate]").each(function(){var a,b=$(this).attr("use"),d=$(this).attr("ns");0===b.indexOf(c+".")&&(b=b.substr(c.length+1),a=f[b]),d&&(a=d+"."+a),$(this).attr("lan",escapeKey(CONFIG.PREFIX+a))}),d.find("a[type=openwindow]").each(function(){var a=getVarStr($(this).attr("url")),b=getVarStr($(this).attr("key"));0===a.indexOf(c+".")&&(a=a.substr(c.length+1),$(this).attr("href",f[a])),0===b.indexOf(c+".")&&(b=b.substr(c.length+1),$(this).text(f[b]))}),d.find("a[type=link]").data($.extend({},f)).attr("data_name",c),d.attr("_index",i),i>0&&d.find("input[type=checkbox],input[type=radio]").each(function(){$(this).removeAttr("required").removeAttr("paramkey")}),d.insertAfter(a),i+=1;0==b.length&&(d=h.clone().attr("from","loop").addClass("from_loop"),g=d.find("td").size(),d.empty().append($("<td>").attr("colspan",7).addClass("tac").text(CU.getDictNameByKey("l6886"))),d.insertAfter(a),a.closest("div.tb-box").removeAttr("style"))}),a.parent().find(">tr[from=loop] input[type=radio]").each(function(a){0===a&&$(this).attr("checked",!0),$(this).attr("idx",a)})}catch(d){}}),$("a[type=openwindow]").each(function(){if(!$(this).closest("[from=loop]"))try{var a=$(this),b=Parser.getVariable(a.attr("url")),c=Parser.getVariable(a.attr("key"));a.attr("href",b),a.text(CU.getDictNameByKey(escapeKey(CONFIG.PREFIX+c)))}catch(d){}}),$("a[type=querybal]").off("click").on("click",function(){try{var a,b=$(this);formValid.checkAll(b.parent())&&(a=b.prev().attr("accountType"),104==a||103==a||108==a||109==a?Common.postRequest(new Model("PsnCrcdQueryAccountDetail",{accountId:b.prev().attr("accountId"),currency:"001"})).then(function(a){var b=CU.ajaxDataHandle(a);CU.isSuccesful(a)&&(b.currency={code:"001"},ctrl.el.append(creditBalance,b,function(){var a=ctrl.el.find("#credDetailPop");ctrl.el.find("#credClose, a.close").on("click",function(){a.remove(),Common.LightBox.hide()}),CU.changeLan(a),CU.setObjAbsCenter(a),Common.LightBox.show(ctrl.el)}))}):Common.postRequest(new Model("PsnAccountQueryAccountDetail",{accountId:b.prev().attr("accountId")+""})).then(function(a){var b=CU.ajaxDataHandle(a);CU.isSuccesful(a)&&ctrl.el.append(queryBalance,{accountDetaiList:b.accountDetaiList},function(){var a=$("#div_balance_query");a.find("a.close,#btn_close_14727").on("click",function(){a.remove(),Common.LightBox.hide()}),CU.changeLan(a),CU.setObjAbsCenter(a),Common.LightBox.show(ctrl.el)})}))}catch(c){}}),$("a[type=dynamictextbox_add]").off("click").on("click",function(){try{var a,b=$(this).parent(),c=$(this).attr("max"),d=b.parent().children(".dynamic[type=dynamictextbox]").size();if(d>c-2)return;a=b.clone(),a.find("input").each(function(){var a,b=$(this),c=b.attr("use")||b.attr("name");b.val(""),c&&(a=Parser.getVariable(c).split("|"),a[d+1]&&b.val(a[d+1]))}),a.find("a[type=dynamictextbox_add]").remove(),a.find("a[type=dynamictextbox_del]").remove(),a.find(".warning").removeClass("warning"),a.addClass("dynamic").attr("type","dynamictextbox").addClass("mt5"),a.insertAfter(d>0?b.parent().children(".dynamic[type=dynamictextbox]").eq(-1):b),d>c-3&&$(this).hide(),$(this).next().show()}catch(e){}}),$("a[type=dynamictextbox_del]").off("click").on("click",function(){try{var a=$(this).parent().parent().children(".dynamic[type=dynamictextbox]");a.size()>0&&a.eq(-1).remove(),0===$(this).parent().parent().children(".dynamic[type=dynamictextbox]").size()&&$(this).hide(),$(this).prev().show()}catch(b){}}),$(container).off("click","a[type=link]").on("click","a[type=link]",function(){var a,b,c,d,e=$(this),f=e.attr("flow"),g=e.attr("step"),h=e.attr("params");if(h)for(h=h.split(","),b=0,c=h.length;c>b;b++)a=h[b].split("="),0===a[1].indexOf(e.attr("data_name")+".")?(a[1]=a[1].substr(e.attr("data_name").length+1),d=e.data()[a[1]]):d=Parser.getVariable(a[1]),sys.context[a[0]]=d;Parser.changeStep(g,f)}),$("input.date").each(function(){try{var a,b,c,d,e=$(this),f=e.attr("isdefault"),g=e.attr("periodtype"),h=e.attr("periodnum"),i=e.attr("datecompare"),j=e.attr("pattern"),k=CONFIG.DATETIME.date,l=null,m=null;i&&(i=i.split(","),a=$("#"+i[0]),b=Parser.getVariable(i[1])||k,c=parseInt(i[2]),i[3]?(d=parseInt(i[3]),0>d?(m=b,l=getPeriodDate(b,"M",d)):(l=b,m=getPeriodDate(b,"M",d))):m=b,a.datepicker({fromDate:l,toDate:m,dateFormat:j?getDatePickerPattern(j):void 0})),"true"==f&&(g&&h&&(k=getPeriodDate(k,g,h)),e.val(k)),e.datepicker({fromDate:l,toDate:m,dateFormat:j?getDatePickerPattern(j):void 0})}catch(n){}}),$(container).find("input[type=text]").each(function(){if(!$(this).closest("tr[from=loop]"))try{var a=Parser.getVariable($(this).attr("name"));a&&$(this).val(a.split("|")[0])}catch(b){}}),$("div.actcombo").each(function(){try{if($(this).closest("dfn.if_type")||$(this).closest("dfn.loop_type")||"true"==$(this).attr("rendered"))return;var a=$(this),b=a.attr("acttype"),c=a.attr("tips")||a.attr("_tips"),d=b?{accountType:b.split(",")}:{},e=Parser.getVariable(a.attr("name"));a.attr("rendered","true"),Common.postRequest(new Model("PsnCommonQueryAllChinaBankAccount",d)).then(function(b){var d,f,g,h,i,j=CU.ajaxDataHandle(b),k={},l={};if(CU.isSuccesful(b)){for(d=[],f=0,g=j.length;g>f;f++)d.push({key:j[f].accountNumber,val:getAccountText(j[f])}),k[j[f].accountNumber]=j[f].accountId,l[j[f].accountNumber]=j[f].accountType,j[f].accountNumber==e&&(i=j[f].accountNumber,h=getAccountText(j[f]),a.attr("accountId",j[f].accountId));new ITSelect({data:d,appendTo:a.empty(),defText:h||(a.attr("def")?CU.getDictNameByKey(escapeKey(CONFIG.PREFIX+a.attr("def"))):""),defValue:i||"",oddCls:"even",callback:function(){a.attr("accountId",k[this.val]),a.attr("accountType",l[this.val])}}),a.attr("tips",c),i&&a.attr("val",i)}})}catch(f){}}),$("div[type=combo]").each(function(){try{var a,b,c,d,e,f=$(this),g=f.attr("tips")||f.attr("_tips"),h=f.next(),i=[],j=f.attr("change");if("options"===h.attr("type"))h.children().each(function(){var a=$(this).attr("value"),b=$(this).attr("text")||$(this).attr("_text"),c=CU.getDictNameByKey(escapeKey(CONFIG.PREFIX+b));i.push({key:a,val:c}),a==Parser.getVariable(f.attr("name"))&&(d=a,e=c)});else if(h=f.next(),"loop"===h.attr("type")){var k,l,m=Parser.getVariable(h.attr("use")),n=h.attr("for"),o=h.children().eq(0),p=getVarStr(o.attr("value")),q=o.attr("text"),r=o.attr("def");q||(q=o.attr("_text")),q=getVarStr(q),r&&(r=getVarStr(r)),0===p.indexOf(n+".")&&(p=p.substr(n.length+1)),0===q.indexOf(n+".")&&(q=q.substr(n.length+1)),r&&0===r.indexOf(n+".")&&(r=r.substr(n.length+1)),r&&(r=Parser.getVariable(r));for(k in m)l=m[k],r==l[p]&&(d=r,e=l[q]),i.push({key:l[p],val:l[q]})}a={data:i,appendTo:f.empty(),defText:e||CU.getDictNameByKey(escapeKey(CONFIG.PREFIX+f.attr("def"))),defValue:d||"",oddCls:"even",isRequired:-1===f.attr("required:false")},d&&f.attr("val",d),j&&(b=flowReg.exec(j),c=stepReg.exec(j),b&&(b=b[1]),c&&(c=c[1]),$.extend(a,{callback:function(){Parser.passVariables(),Parser.changeStep(c,b)}})),new ITSelect(a),f.attr("tips",g)}catch(s){}}),$(container).find("input[type=radio]").each(function(){try{var a,b=$(this).attr("name"),c=Parser.getVariable(b);if(a=$.browser.msie?this[ga]("value"):$(this).val(),null===c||"null"==a)return;c==a&&$(this).attr("checked",!0)}catch(d){}}),$(container).find("input[type=radio][_checked=true]").attr("checked",!0),a=$(container).find("span[type=radio],span[type=checkbox]"),a.size()>0&&(b=$("dfn.loop_type,dfn.if_type").find("span[type=radio],span[type=checkbox]").targets,a=a.filter(function(a){for(var c=0,d=b.length;d>c;c++)if(b[c]===a)return b.splice(c,1),!1;return!0}),a.each(function(){var a=$(this),b=a.find("input").eq(0),c=b.attr("name"),d=b.attr("boundflag");a.parent().is("td")?(b.is(":checked")?a.closest("tr").find("._validateGroup").each(function(){restoreValidate(this)}):a.closest("tr").find(".validateGroup").each(function(){removeValidate(this)}),b.on("change",function(){$(container).find("input[name="+c+"]").each(function(){$(this).is(":checked")?$(this).closest("tr").find("._validateGroup").each(function(){restoreValidate(this)}):$(this).closest("tr").find(".validateGroup").each(function(){removeValidate(this)})})})):(d&&(b.is(":checked")?$(container).find(".bindtarget_"+d+",.bindtarget_"+d+" ._validateGroup").each(function(){restoreValidate(this)}):$(container).find(".bindtarget_"+d+",.bindtarget_"+d+" .validateGroup").each(function(){removeValidate(this)})),b.on("change",function(){$(container).find("input[name="+c+"]").each(function(){var a=$(this).attr("boundflag");a&&(this.checked?$(container).find(".bindtarget_"+a+",.bindtarget_"+a+" ._validateGroup").each(function(){restoreValidate(this)}):$(container).find(".bindtarget_"+a+",.bindtarget_"+a+" .validateGroup").each(function(){removeValidate(this)}))})}))})),$("input[use]").each(function(){try{var a=sys.context[$(this).attr("name")]||Parser.getVariable($(this).attr("use"));a&&(a=a.split("|"),$(this).val(a[0]))}catch(b){}}),$("div[type=pagination]").each(function(){try{var a,b="pagination_"+Common.getIdentityId(),c=sys.context.currentIndex?Math.ceil(sys.context.currentIndex/$(this).attr("pageSize"))+1:1,d=Parser.getVariable($(this).attr("totalNumber")),e=$(this).attr("pageSize")||10,f=Math.ceil(d/e);if(!(d>0))return void $(this).hide();$(this).show(),c>f&&(c=f),$(this).attr("id",b),a={canvas:"#"+b,callbackFn:function(a){Parser.passVariables(),sys.context.currentIndex=(a-1)*this.pageSize,Parser.changeStep()},pageIndex:c,point:ctrl||{el:document.body},recordCount:d,pageSize:e,showDownload:!1};var g=Pager.getInstance();g.init(a)}catch(h){}}),$(container).find("table.tb tr").each(function(){var a=$(this),b="";a.find("td,th").each(function(){b+=$(this).html()}),""==$.trim(b)&&a.hide()}),CU.changeLan($(container)),$("label[pos]").each(function(){try{$(this).html($(this).text().replace(/\\n/g,"<br/>"))}catch(a){}}),$.browser.msie&&$.browser.version<=7&&($(container).find("table.tb").each(function(){$(this).parent().html($(this).parent().html())}),$(container).find("span[type=space]").each(function(){var a=$(this),b=a.prev();try{for(;"loop"===b.attr("type")||"if"===b.attr("type");)b=b.prev();(b.hasClass("fl")||b.hasClass("fr")||"left"===b.css("float")||"right"===b.css("float"))&&a.addClass("fl")}catch(c){}}))},Parser.insertVariables=function(){$(container).find("var[type=use]").each(function(){if(!$(this).closest(".from_loop")){var a=Parser.getVariable($(this).attr("use"));$(this).text(a)}}),$(container).find("var[type=actuse]").each(function(){var a=Parser.getVariable($(this).attr("use"));a=Parser.getVariable(a),$(this).text(a)}),$(container).find("dfn[type=translate]").each(function(){var a=Parser.getVariable($(this).attr("use")),b=$(this).attr("ns");b&&(a=b+"."+a),$(this).attr("lan",escapeKey(CONFIG.PREFIX+a))}),$(container).find("var[type=formatdate]").each(function(){$(this).closest(".from_loop")||$(this).text(formatDate(Parser.getVariable($(this).attr("value")),$(this).attr("pattern")))}),$(container).find("var[lan=num]").each(function(){if(!$(this).closest(".from_loop")){var a=Parser.getVariable(getVarStr($(this).attr("_value")));$(this).text(a),this[sa]("value",a)}})},Parser.clearVariables=function(){$(container).find(".warning,.passed").removeClass("warning").removeAttr("pass"),$(container).find("var[use]").empty(),$(container).find("input[type=text]").val(""),$(container).find("input[type=password]").val(""),$(container).find(".dynamic[type=dynamictextbox]").remove(),$(container).find("a[type=dynamictextbox_add]").show(),$(container).find("a[type=dynamictextbox_del]").hide(),$(container).find("input[type=radio],input[type=checkbox]").attr("checked",!1),$(container).find("div.sel").removeAttr("val").removeAttr("title"),$("#stool-selector").removeClass("chose-stool").empty(),$(container).find("div.actcombo").removeAttr("rendered"),$(container).find(".from_loop").remove()},Parser.getRequestParams=function(a){var b,c={};for(b in a)c[b]="object"==typeof a[b]&&"undefined"!=typeof a[b].value?a[b].value:Parser.getVariable(a[b],b);return c},Parser.getVariable=function(a,b){var c,d,e,f,g,h,i,j,k=["consts","context","response","hidden","review"];if("object"==typeof a&&null!==a){for(d in k)if(c=sys[k[d]][b])break;if(j=[],c)for(g=0,h=c.length;h>g;g++){i=c[g],f={};for(e in a)f[e]=i[a[e]];j.push(f)}return j}try{c=a.split(".");for(d in k){f=sys[k[d]];for(e in c){if("undefined"==typeof f)break;f=f[c[e]]}if("undefined"!=typeof f)return f}}catch(l){return""}return""},Parser.reset=function(){lastFlow=null,lastStep=null,ctrl.sys={consts:{_CIFNUMBER:Common.currentUser.cifNumber,_USERMOBILE:Common.currentUser.mobile,_HOSPITALID:ctrl.flowFileId,_SYSTEMDATETIME:CONFIG.DATETIME.date+" "+CONFIG.DATETIME.time},context:{},db:{},response:{},hidden:{},review:{}},sys=ctrl.sys,ctrl.el.empty(),ctrl.el.off("click")},Parser.passVariables=function(){var a,b,c={};sys.review.DATA_LIST=sys.context.DATA_LIST,sys.context.DATA_LIST=null,sys.context._checkbox_=null,ctrl.el.find("input[type=hidden]").each(function(){var a,b,c,d,e=$(this),f=e.attr("fieldlist").split(","),g=(e.attr("valuelist")+"").split(","),h="true"==e.attr("skipnull");for(a=0,b=f.length;b>a;a++)c=f[a],d=Parser.getVariable(g[a]),h&&null===d||(sys.hidden[c]=d)}),a=ctrl.el.find("*[name]"),a.size()>0&&(b=$("dfn.if_type [name],dfn.loop_type [name]").targets,a.filter(function(a){if("DATA_LIST"==$(a).attr("paramkey")||"radio"==$(a).attr("type")||$(a).attr("bindtarget"))return!1;for(var c=0,d=b.length;d>c;c++)if(b[c]===a)return b.splice(c,1),!1;return!0}),a.each(function(){var a=$(this).attr("name"),b=$(this).val()||$(this).attr("val");sys.context[a]=b,c[a]?isArray(c[a])?c[a].push(b):(c[a]=[c[a]],c[a].push(b)):c[a]=b})),ctrl.el.find("*[name][bindtarget]").each(function(){var a=$(this),b=a.attr("bindtarget");if(ctrl.el.find("input.boundflag_"+b).is(":checked")&&!a.closest("dfn.if_type,dfn.loop_type")&&!a.closest(".from_loop")){var d=$(this).attr("name"),e=$(this).val()||$(this).attr("val");sys.context[d]=e,c[d]?isArray(c[d])?c[d].push(e):(c[d]=[c[d]],c[d].push(e)):c[d]=e}}),ctrl.el.find(".actcombo").each(function(){sys.context[$(this).attr("val")]=$(this).find("span.title label.txt").text()}),ctrl.el.find("input[type=radio]:checked").each(function(){var a,b=$(this).attr("name");a=$.browser.msie?this[ga]("value"):$(this).val(),sys.context[b]=a}),ctrl.el.find("div[type=dynamictextbox]").each(function(){var a=$(this),b=a.attr("bindtarget"),d={};(!b||ctrl.el.find("input.boundflag_"+b).is(":checked"))&&(a.closest("dfn.loop_type")||a.closest("dfn.if_type")||(sys.context.DATA_LIST||(sys.context.DATA_LIST=[]),a.find("*[name]").each(function(){var a=$(this).attr("name"),b=$(this).val();a||(a=this[ga]("name")),d[a]=b,c[a]?isArray(c[a])?c[a].push(b):(c[a]=[c[a]],c[a].push(b)):c[a]=b}),sys.context.DATA_LIST.push(d)))}),ctrl.el.find("span[type=checkbox],span[type=radio]").each(function(){var a=$(this),b=a.find("input").get(0),d={};b.checked&&a.parent().is("td")&&(sys.context.DATA_LIST||(sys.context.DATA_LIST=[]),sys.context._checkbox_||(sys.context._checkbox_={}),a.find("var").each(function(){var a,b=$(this),e=b.attr("bind");try{if(e){a=b.closest("tr").find("[name="+e+"]");var f=b.attr("param"),g=a.val()||a.attr("val");d[f]=g,c[f]?isArray(c[f])?c[f].push(g):(c[f]=[c[f]],c[f].push(g)):c[f]=g}else{var f=b.attr("param"),g=b.attr("value")||Parser.getVariable(b.attr("use"));d[f]=g,c[f]?isArray(c[f])?c[f].push(g):(c[f]=[c[f]],c[f].push(g)):c[f]=g}}catch(h){}}),a.is("span[type=radio]")?$.extend(sys.context,d):(sys.context._checkbox_[b.value]=d,sys.context.DATA_LIST.push(d)))}),$.extend(sys.db,c)},Parser.bindEvents=function(){$(container).on("click","a.btn[step]",function(){var a,b,c,d,e,f,g=!0;if("false"==$(this).attr("checkform"))return Parser.passVariables(),void Parser.changeStep($(this).attr("step"),void 0,!0);try{a=formValid.checkAll(ctrl.el)}catch(h){a=!0}e=ctrl.el.find("span[type=checkbox],span[type=radio]"),e.size()>0&&(f=$("dfn.loop_type,dfn.if_type").find("span[type=checkbox],span[type=radio]").targets,e=e.filter(function(a){for(var b=0,c=f.length;c>b;b++)if(f[b]===a)return f.splice(b,1),!1;return!0}),e.size()>0&&e.find("input[required=true]").each(function(){var d=$(this),e=d.attr("name"),f=d.attr("prompt"),h=$(container).find("span[type=checkbox] input[name="+e+"]:checked,span[type=radio] input[name="+e+"]:checked").size()>0;d.closest("dfn.loop_type,dfn.if_type")||(a=a&&h,g=g&&h,d.closest("div.item-con")&&(b=d.closest("div.item-con").prev().find("label").text().replace(/[\:|：]/g,"")),f&&(c=f))})),ctrl.el.find("input.date[datecompare]").size()>0&&ctrl.el.find("input.date[datecompare]").each(function(){if(!$(this).attr("bindtarget")||$("input.boundflag_"+$(this).attr("bindtarget")).is(":checked")){var b,c,e,f=$(this),g=f.attr("datecompare").split(","),h=$("#"+g[0]),i=Parser.getVariable(g[1])||CONFIG.DATETIME.date,j=parseInt(g[2]),k=g[3],l=f.attr("prompt");return k?(k=parseInt(k),0>k?(b=getPeriodDate(i,"M",k),c=i):(b=i,c=getPeriodDate(i,"M",k))):(b=new Date(0).toString("/"),c=i),f.val()?CU.Date.diff(b,h.val())<0||CU.Date.diff(h.val(),c)<0?(h.attr("passed","false").addClass("warning"),a=!1,void(d="开始时间超出范围!")):CU.Date.diff(b,f.val())<0||CU.Date.diff(f.val(),c)<0?(f.attr("passed","false").addClass("warning"),a=!1,void(d="结束日期超出范围!")):CU.Date.diff(h.val(),f.val())<0?(h.attr("passed","false").addClass("warning"),f.attr("passed","false").addClass("warning"),a=!1,void(d="开始时间不能大于结束时间!")):(e=getPeriodDate(f.val(),"M",-j),CU.Date.diff(e,h.val())<0?(h.attr("passed","false").addClass("warning"),f.attr("passed","false").addClass("warning"),a=!1,void(d=l?l:"结束日期必输且起始日期和结束日期之间的间隔不能超过"+digits[j]+"个月!")):void 0):void(a=!1)
}}),ctrl.el.find("input[equalto]").size()>0&&ctrl.el.find("input[equalto]").each(function(){var b=$(this),c=ctrl.el.find("*[name="+b.attr("equalto")+"]");try{b.val()!=c.val()&&(b.addClass("warning"),d="两次输入必须一致！",a=!1)}catch(e){}}),$("#stool-selector").hasClass("chose-stool")&&(a=a&&Common.SF.check()),a?(Parser.passVariables(),Parser.changeStep($(this).attr("step"),void 0,!0)):(g===!1&&Common.LightBox.showMessage(c?c:b?CU.getDictNameByKey("l0092")+b:CU.getDictNameByKey("l8986")),d&&Common.LightBox.showMessage(d))})},Parser.parseMenu=function(a){var b,c,d,e=xml[gt]("menu")[0],f=e[gt]("item"),g=[],h="tabs-current";for(c=0,d=f.length;d>c;c++)b=f[c],g.push({lan:escapeKey(CONFIG.PREFIX+b[cn][0][nv]),flow:b[ga]("flow")});ctrl.el.append(CONFIG.EJS.TABS,{tabs:g},function(){ctrl.el.find("#mstabs li[flow]").on("click",function(){sys.context={},sys.db={},sys.response={},sys.hidden={},sys.review={},$("#mstabs li[flow]").removeClass(h),$(this).addClass(h),Parser.changeStep(null,$(this).attr("flow"))}),a&&a()})},Parser.parseFlow=function(){var a,b,c,d,e={},f=xml[gt]("flow");for(c=0,d=f.length;d>c;c++)a=f[c],b=a[ga]("name"),e[b]=Parser.parseStep(a[gt]("step")),e[b].name=b,0===c&&(sys.first=e[b]);sys.flows=e},Parser.parseStep=function(a){var b,c,d,e,f,g,h={};for(f=0,g=a.length;g>f;f++)e=a[f],c=e[ga]("name"),b={name:c,action:Parser.parseAction(e[gt]("action")),view:Parser.parseViewFrag(e[gt]("view")[0])},Parser.addSecurityElem(b.view),h[c]=b,0===f&&(d=b);return{steps:h,first:d}},Parser.addSecurityElem=function(a){var b,c,d,e,f=ce("div"),g=ce("ul");for(f[sa]("id","stool-selector"),g[sa]("id","stool-list"),g[cs]="layout-lr border-box hide",b=0,c=a.childNodes.length;c>b;b++)if(d=a.childNodes[b],"p"===d.nodeName.toLowerCase()&&"btn-box tac"===d[cs]){e=d;break}return e?(a.insertBefore(f,e),a.insertBefore(g,e)):(a[ac](f),a[ac](g)),a},Parser.parseAction=function(a){var b,c,d,e,f,g,h=a.length,i=null,j=null;if(0===h)return null;for(b=0;h>b;b++)c=a[b],d=c.parentNode,e=d.nodeName.toLowerCase(),"if"===e&&(f=getVarStr(d[ga]("test"))),g=Parser.parseComm(c[gt]("comm"),f,b),g&&(i||(i={}),$.extend(i,g)),j||(j=Parser.parseSecurity(c[gt]("security"),f));return{comms:i,security:j}},Parser.parseComm=function(a,b,c){var d,e,f,g,h=null;for(e=0,f=a.length;f>e;e++)d=a[e],g=d[ga]("name"),h||(h={}),h[g]={transaction:d[ga]("transaction"),bankId:d[ga]("bankid"),request:Parser.parseRequest(d[gt]("request")),response:Parser.parseResponse(d[gt]("response"))},b&&(h[g].cond=b),c>0&&(h[g].step=c);return h},Parser.parseSecurity=function(a,b){if(!a||0===a.length)return null;a=a[0];var c={action:a[ga]("action")};return a[gt]("stamp").length>0&&(c.stamp=a[gt]("stamp")[0][cn][0][nv]),a[gt]("ssm").length>0&&(c.ssm=a[gt]("ssm")[0][cn][0][nv]),b&&(c.cond=b),c},Parser.parseRequest=function(a){return 0===a.length?null:(a=a[0],Parser.parseParam(a))},Parser.parseResponse=function(a){return 0===a.length?null:(a=a[0],Parser.parseParam(a))},Parser.parseParam=function(a){var b,c,d,e,f=a[gt]("param"),g={};switch(a.nodeName.toLowerCase()){case"request":for(c=0,d=f.length;d>c;c++)if(b=f[c],"datalist"===b.parentNode.nodeName.toLowerCase()){g[b.parentNode[ga]("name")]||(g[b.parentNode[ga]("name")]={}),e=g[b.parentNode[ga]("name")];try{e[b[ga]("name")]=b[gt]("use")[0][cn][0][nv]}catch(h){e[b[ga]("name")]={value:b[cn][0][nv]}}}else try{g[b[ga]("name")]=b[gt]("use")[0][cn][0][nv]}catch(h){try{g[b[ga]("name")]={value:b[cn][0][nv]}}catch(i){g[b[ga]("name")]={value:""}}}break;case"response":for(c=0,d=f.length;d>c;c++){b=f[c];try{g[b[ga]("name")]=b[gt]("use")[0][cn][0][nv]}catch(h){g[b[ga]("name")]=b[cn][0][nv]}}break;default:g=null}return g},Parser.parseViewFrag=function(a,b){try{var c,d,e,f,g,h,i,j=a[cn],k=cf(),b=b||{};for(g=h=0,i=j.length;i>g;g++){if(c=j[g],f=null,1===c.nodeType&&(d=c.nodeName.toLowerCase(),e=Parser.parseViewElementFunctions[d])){try{f=e(c,h,b)}catch(l){}h++}f&&(k[ac](f),b.col1&&b.col2&&b[1&h?"col1":"col2"][ac](f))}}catch(l){}return k},Parser.parseViewElementFunctions={hiddenbox:function(a){var b=ce("input"),c=a[ga]("fieldlist"),d=a[ga]("valuelist"),e=a[ga]("skipnull");return b[sa]("type","hidden"),b[sa]("fieldlist",c),b[sa]("valuelist",d),b[sa]("skipnull",e),b},panel:function(a){var b,c,d,e=a[ga]("type"),f=a[ga]("layout");return"button"===e?(b=ce("p"),b[cs]="btn-box tac",b[ac](Parser.parseViewFrag(a))):"2"===f?(b=ce("div"),b[cs]="row-w border-box clearfix",c=ce("ul"),d=ce("ul"),c[cs]="layout-lr row02",d[cs]="layout-lr row02",Parser.parseViewFrag(a,{col1:c,col2:d}),b[ac](c),b[ac](d)):a[gt]("page").length>0?(b=ce("div"),b[cs]="p20 layout-title",b[ac](Parser.parseViewFrag(a))):(b=ce("ul"),b[cs]="layout-lr",b[ac](Parser.parseViewFrag(a))),b},button:function(a){var b=ce("a"),c=ce("span"),d=a[cn][0][nv],e=a[ga]("target"),f=a[ga]("checkform");return b[sa]("href","javascript:void(0)"),b[sa]("step",e),b[cs]="btn",c[sa]("lan",escapeKey(CONFIG.PREFIX+d)),c[cs]="btn-r",b[ac](c),f&&(b[sa]("checkform",f),"false"==f&&(b[cs]="btn btn-gray")),b},pagetip:function(a){var b=ce("p"),c=ce("label"),d=a[ga]("viewid"),e=a[ga]("position");return c[sa]("lan",escapeKey(CONFIG.PREFIX+d)),b[cs]="pos",b[ac](c),"bottom"===e?c[sa]("pos","bottom"):c[sa]("pos","top"),b},newline:function(a){for(var b=cf(),c=a[ga]("count")||1;c--;)b[ac](ce("br"));return b},table:function(a){var b=ce("div"),c=ce("table");return b[cs]="tb-box tb-scroll",c[cs]="tb tb-op",b[ac](c),c[ac](Parser.parseViewFrag(a)),b},row:function(a,b){var c=ce("tr"),d=1&b?"odd":"even";return c[cs]=d,c[ac](Parser.parseViewFrag(a)),c},cell:function(a,b){var c=a[ga]("type"),d="header"===c?"th":"td",e=ce(d);return 0===b&&(e[cs]="first"),e[ac](Parser.parseViewFrag(a)),e},pagination:function(a){var b=ce("div"),c=a[ga]("totalnumber"),d=a[ga]("pagesize");return b[cs]="page-right",b[sa]("type","pagination"),b[sa]("totalNumber",getVarStr(c)),b[sa]("pageSize",d),b},pageitem:function(a){var b,c,d=ce("li"),e=ce("span"),f=ce("label"),g=a[ga]("label"),h=ce("div");return g&&f[sa]("lan",escapeKey(CONFIG.PREFIX+g)),e[cs]="item-title",h[cs]="item-con",a[cn].length>0&&h[ac](Parser.parseViewFrag(a)),$(h).find(".validateGroup").each(function(){$(this).attr("validateGroup").indexOf("required:true")>-1&&(b=!0)}),$(h).find("[equalto]").size()>0&&(b=!0),b&&(c=ce("span"),c[cs]="mr5",c[ac](ct("*")),e[ac](c)),e[ac](f),d[cs]="clearfix",d[ac](e),d[ac](h),d},font:function(a){var b=ce("font"),c=a[ga]("color");return b[sa]("color",c),b[ac](1===a[cn].length&&3===a[cn][0].nodeType?ct(a[cn][0][nv]):Parser.parseViewFrag(a)),b},actcombo:function(a){var b,c,d=cf(),e=ce("div"),f=a[ga]("name"),g=a[ga]("default"),h=a[ga]("acttype"),i=a[ga]("checkrule"),j="true"==a[ga]("querybal"),k=a[ga]("useprompt"),l=a[ga]("prompt");return e[cs]="sel w200 actcombo",e[sa]("name",f),g&&e[sa]("def",g),h&&e[sa]("acttype",h),setValidateGroupAndTips(e,i,l,k),d[ac](e),j&&(b=ce("a"),b[cs]="btn btn-gray-s ml10 querybal",b[sa]("href","javascript:void(0)"),b[sa]("type","querybal"),c=ce("span"),c[cs]="btn-r",c[sa]("lan","l0116"),b[ac](c),d[ac](b)),d},actuse:function(a){var b=ce("var");return b[sa]("type","actuse"),b[sa]("use",a[cn][0][nv]),b},radio:function(a){var b,c,d,e,f,g,h,i,j=ce("span"),k=ce("label"),l=a[ga]("name"),m=a[ga]("value"),n="true"===a[ga]("checked"),o=a[ga]("params"),p=a[ga]("boundflag");try{b=a[cn][0][nv]}catch(q){b=a[ga]("label")}if(j[cs]="ck-rd",j[sa]("type","radio"),$.browser.msie&&$.browser.version<=7?i=ce('<input name="'+l+'">'):(i=ce("input"),i[sa]("name",l)),i[cs]="type",i[sa]("type","radio"),i[sa]("value",m),n&&(i[sa]("checked",n),i[sa]("_checked",n)),p&&(i[sa]("boundflag",p),i[cs]=i[cs]+" boundflag_"+p),o)for(o=o.split(","),c=0,d=o.length;d>c;c++)e=o[c].split(":"),f=e[0],g=getVarStr(e[1]),h=ce("var"),h[cs]="hide",h[sa]("param",f),h[sa]("use",g),j[ac](h);return k[cs]="txt",k[sa]("for",l),b&&k[sa]("lan",escapeKey(CONFIG.PREFIX+b)),j[ac](i),j[ac](k),j},space:function(a){for(var b=ce("span"),c=a[ga]("count")||1,d="";c--;)d+="&nbsp;";return b.innerHTML=d,b[sa]("type","space"),b},use:function(a){var b=ce("var");return b[sa]("type","use"),b[sa]("use",a[cn][0][nv]),b},textbox:function(a,b,c){var d,e,f=cf(),g=a[ga]("type"),h=a[ga]("name"),i=a[ga]("label"),j=a[ga]("checkrule"),k=a[ga]("prompt"),l=a[ga]("useprompt"),m=a[gt]("use"),n=a[ga]("bindtarget");return $.browser.msie&&$.browser.version<=7?d=ce('<input name="'+h+'">'):(d=ce("input"),d[sa]("name",h)),"password"!==g&&(g="text"),d[cs]="input",d[sa]("type",g),c.attr&&($(d).attr(c.attr),c.attr.from&&$(d).addClass("from_"+c.attr.from)),setValidateGroupAndTips(d,j,k,l),m&&m.length>0&&d[sa]("use",m[0][cn][0][nv]),i&&(e=ce("label"),e[cs]="mr5",e[sa]("lan",escapeKey(CONFIG.PREFIX+i)),f[ac](e),d[cs]="input w80 mr5"),n&&(d[sa]("bindtarget",n),d[cs]=d[cs]+" bindtarget_"+n),f[ac](d),f},combo:function(a){var b,c=cf(),d=ce("div"),e=a[ga]("name"),f=a[ga]("label"),g=a[ga]("default"),h=a[ga]("onchange"),i=a[ga]("checkrule"),j=a[ga]("prompt"),k=a[ga]("useprompt"),l=Parser.parseViewFrag(a),m=ce("dfn"),n=a[ga]("bindtarget");return d[cs]="sel w150 mr5",d[sa]("name",e),d[sa]("def",g),d[sa]("type","combo"),h&&d[sa]("change",h),n&&(d[sa]("bindtarget",n),d[cs]=d[cs]+" bindtarget_"+n),f&&(b=ce("label"),b[cs]="fl mr5",b[sa]("lan",escapeKey(CONFIG.PREFIX+f)),c[ac](b)),setValidateGroupAndTips(d,i,j,k),c[ac](d),"dfn"===l[cn][0].nodeName.toLowerCase()?c[ac](l):(m[sa]("type","options"),m[cs]="hide",m[ac](l),c[ac](m)),c},option:function(a){var b=a[ga]("value"),c=a[ga]("currentvalue"),d=ce("option"),e=a[cn][0][nv]||a[gt]("use")[0][cn][0][nv];return d[sa]("value",b),d[sa]("text",e),d[sa]("_text",e),c&&d[sa]("def",c),d},dateinput:function(a){var b,c=cf(),d=ce("label"),e=a[ga]("name"),f=a[ga]("checkrule"),g=a[ga]("isdefault"),h=a[ga]("periodtype"),i=a[ga]("periodnum"),j=a[ga]("useprompt"),k=a[ga]("prompt"),l=a[ga]("label"),m=a[ga]("pattern"),n=a[ga]("bindtarget");return $.browser.msie&&$.browser.version<=7?b=ce('<input name="'+e+'">'):(b=ce("input"),b[sa]("name",e)),b[cs]="input date",b[sa]("lan","date"),b[sa]("type","text"),b[sa]("id",e),l&&d[sa]("lan",escapeKey(CONFIG.PREFIX+l)),g&&b[sa]("isdefault",g),h&&b[sa]("periodtype",h),i&&b[sa]("periodnum",i),n&&(b[sa]("bindtarget",n),b[cs]=b[cs]+" bindtarget_"+n),m&&b[sa]("pattern",m),setValidateGroupAndTips(b,f,k,j),c[ac](d),c[ac](b),c},translate:function(a){var b,c=ce("dfn"),d=a[ga]("namespace"),e=a[gt]("use");return e.length>0?(d&&c[sa]("ns",d),c[sa]("use",e[0][cn][0][nv]),c[sa]("type","translate")):(b=a[cn][0][nv],d&&(b=d+"."+b),c[sa]("lan",escapeKey(CONFIG.PREFIX+b))),c},link:function(a){var b=ce("a"),c=a[ga]("flow"),d=a[ga]("step"),e=a[ga]("params"),f=a[ga]("label");return b[sa]("href","javascript:void(0)"),b[sa]("flow",c),b[sa]("step",d),e&&b[sa]("params",e),b[sa]("lan",escapeKey(CONFIG.PREFIX+f)),b[sa]("type","link"),b},openwindow:function(a){var b=ce("a"),c=a[ga]("url"),d=a[ga]("label");return d=getVarStr(d),b[sa]("type","openwindow"),b[sa]("url",c),b[sa]("key",d),b[sa]("target","_blank"),b},loop:function(a){var b=ce("dfn"),c=a[ga]("for"),d=a[ga]("use");return b[sa]("type","loop"),b[sa]("for",c),b[sa]("use",d),b[cs]="loop_type hide",b[ac](Parser.parseViewFrag(a,{attr:{from:"loop"}})),b},"if":function(a){var b=ce("dfn"),c=getVarStr(a[ga]("test"));return b[cs]="if_type hide",b[sa]("type","if"),b[sa]("test",c),b[ac](Parser.parseViewFrag(a)),b},checkbox:function(a){var b,c,d,e,f,g=a[ga]("label"),h=a[ga]("name"),i=ce("span"),j=ce("label"),k=a[gt]("optvalue"),l=a[ga]("paramkey"),m=a[ga]("checkrule"),n=a[ga]("useprompt"),o=a[ga]("prompt"),p=a[ga]("boundflag");for(d=0,e=k.length;e>d;d++)b=k[d],c=ce("var"),c[cs]="hide",c[sa]("param",b[ga]("param")),b[gt]("use").length>0?c[sa]("use",b[gt]("use")[0][cn][0][nv]):c[sa]("value",b[cn][0][nv]),i[ac](c);return i[cs]="ck-rd ml5",i[sa]("type","checkbox"),$.browser.msie&&$.browser.version<=7?f=ce('<input name="'+h+'">'):(f=ce("input"),f[sa]("name",h)),f[cs]="type",f[sa]("type","checkbox"),l&&f[sa]("paramkey",l),m&&m.indexOf("required:true")>-1&&f[sa]("required","true"),n&&setValidateGroupAndTips(f,m,o,n),p&&(f[sa]("boundflag",p),f[cs]=f[cs]),j[cs]="txt",g&&(varReg.test(g)?j[sa]("use",g):j[sa]("lan",escapeKey(CONFIG.PREFIX+g))),i[ac](f),i[ac](j),i},registerdb:function(a){var b=ce("dfn"),c=a[ga]("summary"),d=a[ga]("argskey"),e=a[ga]("flowname"),f=a[ga]("stepname"),g=a[ga]("isdisp");return b[cs]="hide",b[sa]("type","registerdb"),b[sa]("summary",c),b[sa]("argskey",d),b[sa]("flowname",e),b[sa]("stepname",f),b[sa]("isdisp",g),b},dynamictextbox:function(a){var b=ce("div"),c=a[ga]("max"),d=ce("a"),e=ce("a"),f=a[ga]("bindtarget");return b[sa]("type","dynamictextbox"),b[ac](Parser.parseViewFrag(a,{attr:{paramkey:a[ga]("paramkey")}})),f&&(b[sa]("bindtarget",f),b[cs]=b[cs]+" bindtarget_"+f),d[cs]="ml5",d[sa]("lan","l5293"),d[sa]("type","dynamictextbox_add"),d[sa]("href","javascript:void(0)"),d[sa]("max",c),e[cs]="ml5 hide",e[sa]("lan","l0309"),e[sa]("type","dynamictextbox_del"),e[sa]("href","javascript:void(0)"),b[ac](d),b[ac](e),b},formatdate:function(a){var b=ce("var"),c=a[ga]("value"),d=a[ga]("pattern");return c=getVarStr(c),b[sa]("type","formatdate"),b[sa]("value",c),b[sa]("pattern",d),b},formatnumber:function(a){var b=ce("var"),c=a[ga]("value"),d=a[ga]("currency");return b[sa]("lan","num"),b[sa]("currCode",d),b[sa]("_value",c),b[ac](ct(c)),b},page:function(a){var b=ce("p"),c=a[ga]("label");return c&&b[sa]("lan",escapeKey(CONFIG.PREFIX+c)),b}},window.MS_Parser=Parser}(document);