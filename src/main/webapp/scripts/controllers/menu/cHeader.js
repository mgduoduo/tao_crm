/*! BUILD: 2015-02-11 */
Common.controllers.Header=Spine.Controller.sub({el:"#header",events:{"click #a_55_1164":"changeEn","click #a_56_1165":"changeCn","click #a_59_1168":"logout","focus #search":"search","blur #search":"search","keydown #search":"search","click #a_58_1167":"help"},init:function(){"C"===lan?$("#a_56_1165").hide():$("#a_55_1164").hide(),CU.changeLan(this.el),$("#func-keyword").on("keydown",this.proxy(this.search)),this.initSearchEngine()},initSearchEngine:function(){var a,b,c,d,e,f,g,h,i,j,k=this,l=[],m={};a=66==Common.currentUser.segmentId||1==Common.currentUser.segmentId?Common.menu.MenuForVip:Common.menu.MenuForSearch,m.WelcomePage=CU.getDictNameByKey("l0027");for(var d=0,e=a.top.length;e>d;d++)j=a.top[d],m[j.key]={lan:j.lan,name:CU.getDictNameByKey(j.lan)};for(var d=0,e=a.bottom.length;e>d;d++)j=a.bottom[d],m[j.key]={lan:j.lan,name:CU.getDictNameByKey(j.lan)};for(b in Common.menu.MenuHash)if(c=Common.menu.MenuHash[b],isArray(c))for(d=0,e=c.length;e>d;d++)if(f=c[d],f.controller&&l.push({name:CU.getDictNameByKey(f.lan),lan:f.lan,controller:f.controller,parent:{lv1key:b,lan:m[b].lan,name:m[b].name}}),f.submenu)for(g=0,h=f.submenu.length;h>g;g++)i=f.submenu[g],i.controller&&l.push({name:CU.getDictNameByKey(i.lan),controller:i.controller,lan:i.lan,parent:{lv2key:f.key,controller:f.controller,name:CU.getDictNameByKey(f.lan),lan:f.lan,parent:{lv1key:b,lan:m[b].lan,name:m[b].name}}});k.funcMap=l,$("#func-close").off("click").on("click",function(){$("#funcBox").hide(),Common.LightBox.hide()}),$("#func-search").off("click").on("click",function(){formValid.checkAll($("#func-keyword").parent()),k.doSearch($("#func-keyword").val())}),$("#func-result").off("click").on("click","a[controller]",function(){$("#func-close").trigger("click"),Common.triggerAction($(this).attr("controller"))}).on("click","a[lv1]",function(){$("#func-close").trigger("click"),$("ul.bu-nav>li>a[key="+$(this).attr("lv1")+"]").trigger("click")}).on("click","a[lv2]",function(){$(this).is("[controller]")}),k.el.find(".search-icon").off("click").on("click",function(){formValid.checkAll($("#search").parent()),k.doSearch($.trim($("#search").val())),$("#search").trigger("blur")})},changeEn:function(){$("#a_55_1164").hide(),$("#a_56_1165").show(),lan="E",1==$("#draw_deposit_iframe_1418").length&&draw_deposit_iframe_name.CU.changeMyLan(lan),window.lan_prev="C",$("html").addClass("en"),CU.changeLan(),Spine.trigger("language_changed"),this.initSearchEngine()},changeCn:function(){$("#a_56_1165").hide(),$("#a_55_1164").show(),lan="C",1==$("#draw_deposit_iframe_1418").length&&draw_deposit_iframe_name.CU.changeMyLan(lan),window.lan_prev="E",$("html").removeClass("en"),CU.changeLan(),Spine.trigger("language_changed"),this.initSearchEngine()},logout:function(){var a=this,b=document.getElementById("jitsigntk");b||Common.Signer.init({container:null});var c=Common.Signer.isKeyPullOut().error;null==c?(Common.LightBox.show(),CU.changeLan($("#quit-dialog")),CU.setObjAbsCenter($("#quit-dialog").show()),$("#quit-confirm").off("click").on("click",function(){a.checkBeforeLogout()})):(Common.LightBox.show(),a.checkBeforeLogout())},checkBeforeLogout:function(){var a,b,c,d=this,e=Common.mainAction;if(e&&e.length>0)for(a=0,b=e.length;b>a;a++)if(c=e[a],c&&c.beforeLogout)return c.beforeLogout(d.doLogout);d.doLogout()},doLogout:function(){Common.postRequest(new Model("Logout")).then(function(a){CU.ajaxDataHandle(a),CU.isSuccesful(a)?($.removeCookie("jsessionid"),window.location.href="logout.html?title="+escape(CU.getDictNameByKey("l15794"))+"&locale="+localParam[lan]):(Common.LightBox.hide(),$("#quit-dialog").hide())})},search:function(a){switch(a.type){case"focusin":$.trim($("#search").val())===CU.getDictNameByKey("l14855")&&$("#search").val("").removeClass("text-darkengray");break;case"focusout":""===$.trim($("#search").val())&&$("#search").val(CU.getDictNameByKey("l14855")).addClass("text-darkengray");break;case"keydown":a=window.event||a,(13===a.which||13===a.keyCode)&&this.doSearch($.trim($(a.target||a.srcElement).val()))}},makeLink:function(a,b){var c=b?"<span ":'<a href="javascript:void(0);" ';return a.controller&&(c+='controller="'+a.controller+'" '),a.lv2key&&(c+='lv2="'+a.lv2key+'" '),a.lv1key&&(c+='lv1="'+a.lv1key+'" '),c+='lan="'+a.lan+'" class="ml5 mr5">'+a.name,b?(c+="</span>",c+='<span class="text-blue">&gt;</span>'):c+="</a>",c},doSearch:function(a){var b,c,d,e,f=0;if(a=$.trim(a),$("#func-result").empty(),$("#search").attr("phLan","l14855").val(CU.getDictNameByKey("l14855")).addClass("text-darkengray"),a)for(b=0,c=this.funcMap.length;c>b;b++)d=this.funcMap[b],d.name=CU.getDictNameByKey(d.lan),LiquidMetal.score(d.name,a)>0&&(f+=1,e=this.makeLink(d),d.parent&&(e=this.makeLink(d.parent,!0)+e,d.parent.parent&&(e=this.makeLink(d.parent.parent,!0)+e)),$("#func-result").append($("<li>"+e+"</li>")).show());f>0?($("#sorry-keyword").parent().hide(),$("#func-result").show(),$("#func-records").text(f).parent().show()):($("#sorry-keyword").parent().show(),a?($("#sorry-keyword").text(a),$("#no-keyword").hide().siblings().show()):$("#no-keyword").show().siblings().hide(),$("#func-result").hide(),$("#func-records").parent().hide()),$("#funcBox").is(":visible")||($("#funcBox").show(),Common.LightBox.show()),$("#func-keyword").val(a).focus(),CU.setObjAbsCenter($("#funcBox")),CU.changeLan($("#funcBox")),$("#func-result").get(0).scrollTop=0},help:function(){var a=$(".nav-item.current a").attr("key"),b=Common.currentActionType||"",c="help.html?locale="+("C"==lan?"zh_CN":"en_US")+"&menu="+a+"#"+b;window.open(c,null,"toolbar=no, menubar=no,scrollbars=yes,resizable=yes, location=no, status=no,fullscreen=yes")}});